'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createClient = createClient;

const parser = require('./PostgresConfigParser');

function createClient(uri, databaseOptions) {
  let dbOptions = {};
  databaseOptions = databaseOptions || {};

  if (uri) {
    dbOptions = parser.getDatabaseOptionsFromURI(uri);
  }

  for (const key in databaseOptions) {
    dbOptions[key] = databaseOptions[key];
  }

  const initOptions = dbOptions.initOptions || {};
  const pgp = require('pg-promise')(initOptions);
  const client = pgp(dbOptions);

  if (dbOptions.pgOptions) {
    for (const key in dbOptions.pgOptions) {
      pgp.pg.defaults[key] = dbOptions.pgOptions[key];
    }
  }

  return { client, pgp };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9BZGFwdGVycy9TdG9yYWdlL1Bvc3RncmVzL1Bvc3RncmVzQ2xpZW50LmpzIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInBhcnNlciIsInJlcXVpcmUiLCJ1cmkiLCJkYXRhYmFzZU9wdGlvbnMiLCJkYk9wdGlvbnMiLCJnZXREYXRhYmFzZU9wdGlvbnNGcm9tVVJJIiwia2V5IiwiaW5pdE9wdGlvbnMiLCJwZ3AiLCJjbGllbnQiLCJwZ09wdGlvbnMiLCJwZyIsImRlZmF1bHRzIl0sIm1hcHBpbmdzIjoiOzs7OztRQUdnQkEsWSxHQUFBQSxZOztBQUZoQixNQUFNQyxTQUFTQyxRQUFRLHdCQUFSLENBQWY7O0FBRU8sU0FBU0YsWUFBVCxDQUFzQkcsR0FBdEIsRUFBMkJDLGVBQTNCLEVBQTRDO0FBQ2pELE1BQUlDLFlBQVksRUFBaEI7QUFDQUQsb0JBQWtCQSxtQkFBbUIsRUFBckM7O0FBRUEsTUFBSUQsR0FBSixFQUFTO0FBQ1BFLGdCQUFZSixPQUFPSyx5QkFBUCxDQUFpQ0gsR0FBakMsQ0FBWjtBQUNEOztBQUVELE9BQUssTUFBTUksR0FBWCxJQUFrQkgsZUFBbEIsRUFBbUM7QUFDakNDLGNBQVVFLEdBQVYsSUFBaUJILGdCQUFnQkcsR0FBaEIsQ0FBakI7QUFDRDs7QUFFRCxRQUFNQyxjQUFjSCxVQUFVRyxXQUFWLElBQXlCLEVBQTdDO0FBQ0EsUUFBTUMsTUFBTVAsUUFBUSxZQUFSLEVBQXNCTSxXQUF0QixDQUFaO0FBQ0EsUUFBTUUsU0FBU0QsSUFBSUosU0FBSixDQUFmOztBQUVBLE1BQUlBLFVBQVVNLFNBQWQsRUFBeUI7QUFDdkIsU0FBSyxNQUFNSixHQUFYLElBQWtCRixVQUFVTSxTQUE1QixFQUF1QztBQUNyQ0YsVUFBSUcsRUFBSixDQUFPQyxRQUFQLENBQWdCTixHQUFoQixJQUF1QkYsVUFBVU0sU0FBVixDQUFvQkosR0FBcEIsQ0FBdkI7QUFDRDtBQUNGOztBQUVELFNBQU8sRUFBRUcsTUFBRixFQUFVRCxHQUFWLEVBQVA7QUFDRCIsImZpbGUiOiJQb3N0Z3Jlc0NsaWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuY29uc3QgcGFyc2VyID0gcmVxdWlyZSgnLi9Qb3N0Z3Jlc0NvbmZpZ1BhcnNlcicpO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ2xpZW50KHVyaSwgZGF0YWJhc2VPcHRpb25zKSB7XG4gIGxldCBkYk9wdGlvbnMgPSB7fTtcbiAgZGF0YWJhc2VPcHRpb25zID0gZGF0YWJhc2VPcHRpb25zIHx8IHt9O1xuXG4gIGlmICh1cmkpIHtcbiAgICBkYk9wdGlvbnMgPSBwYXJzZXIuZ2V0RGF0YWJhc2VPcHRpb25zRnJvbVVSSSh1cmkpO1xuICB9XG5cbiAgZm9yIChjb25zdCBrZXkgaW4gZGF0YWJhc2VPcHRpb25zKSB7XG4gICAgZGJPcHRpb25zW2tleV0gPSBkYXRhYmFzZU9wdGlvbnNba2V5XTtcbiAgfVxuXG4gIGNvbnN0IGluaXRPcHRpb25zID0gZGJPcHRpb25zLmluaXRPcHRpb25zIHx8IHt9O1xuICBjb25zdCBwZ3AgPSByZXF1aXJlKCdwZy1wcm9taXNlJykoaW5pdE9wdGlvbnMpO1xuICBjb25zdCBjbGllbnQgPSBwZ3AoZGJPcHRpb25zKTtcblxuICBpZiAoZGJPcHRpb25zLnBnT3B0aW9ucykge1xuICAgIGZvciAoY29uc3Qga2V5IGluIGRiT3B0aW9ucy5wZ09wdGlvbnMpIHtcbiAgICAgIHBncC5wZy5kZWZhdWx0c1trZXldID0gZGJPcHRpb25zLnBnT3B0aW9uc1trZXldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IGNsaWVudCwgcGdwIH07XG59XG4iXX0=
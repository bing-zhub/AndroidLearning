'use strict';

var _AdapterLoader = require('../AdapterLoader');

var _AdapterLoader2 = _interopRequireDefault(_AdapterLoader);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const facebook = require('./facebook');
const facebookaccountkit = require('./facebookaccountkit');
const instagram = require("./instagram");
const linkedin = require("./linkedin");
const meetup = require("./meetup");
const google = require("./google");
const github = require("./github");
const twitter = require("./twitter");
const spotify = require("./spotify");
const digits = require("./twitter"); // digits tokens are validated by twitter
const janrainengage = require("./janrainengage");
const janraincapture = require("./janraincapture");
const vkontakte = require("./vkontakte");
const qq = require("./qq");
const wechat = require("./wechat");
const weibo = require("./weibo");

const anonymous = {
  validateAuthData: () => {
    return Promise.resolve();
  },
  validateAppId: () => {
    return Promise.resolve();
  }
};

const providers = {
  facebook,
  facebookaccountkit,
  instagram,
  linkedin,
  meetup,
  google,
  github,
  twitter,
  spotify,
  anonymous,
  digits,
  janrainengage,
  janraincapture,
  vkontakte,
  qq,
  wechat,
  weibo
};
function authDataValidator(adapter, appIds, options) {
  return function (authData) {
    return adapter.validateAuthData(authData, options).then(() => {
      if (appIds) {
        return adapter.validateAppId(appIds, authData, options);
      }
      return Promise.resolve();
    });
  };
}

function loadAuthAdapter(provider, authOptions) {
  const defaultAdapter = providers[provider];
  const adapter = Object.assign({}, defaultAdapter);
  const providerOptions = authOptions[provider];

  if (!defaultAdapter && !providerOptions) {
    return;
  }

  const appIds = providerOptions ? providerOptions.appIds : undefined;

  // Try the configuration methods
  if (providerOptions) {
    const optionalAdapter = (0, _AdapterLoader2.default)(providerOptions, undefined, providerOptions);
    if (optionalAdapter) {
      ['validateAuthData', 'validateAppId'].forEach(key => {
        if (optionalAdapter[key]) {
          adapter[key] = optionalAdapter[key];
        }
      });
    }
  }

  if (!adapter.validateAuthData || !adapter.validateAppId) {
    return;
  }

  return { adapter, appIds, providerOptions };
}

module.exports = function (authOptions = {}, enableAnonymousUsers = true) {
  let _enableAnonymousUsers = enableAnonymousUsers;
  const setEnableAnonymousUsers = function (enable) {
    _enableAnonymousUsers = enable;
  };
  // To handle the test cases on configuration
  const getValidatorForProvider = function (provider) {

    if (provider === 'anonymous' && !_enableAnonymousUsers) {
      return;
    }

    const {
      adapter,
      appIds,
      providerOptions
    } = loadAuthAdapter(provider, authOptions);

    return authDataValidator(adapter, appIds, providerOptions);
  };

  return Object.freeze({
    getValidatorForProvider,
    setEnableAnonymousUsers
  });
};

module.exports.loadAuthAdapter = loadAuthAdapter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL2luZGV4LmpzIl0sIm5hbWVzIjpbImZhY2Vib29rIiwicmVxdWlyZSIsImZhY2Vib29rYWNjb3VudGtpdCIsImluc3RhZ3JhbSIsImxpbmtlZGluIiwibWVldHVwIiwiZ29vZ2xlIiwiZ2l0aHViIiwidHdpdHRlciIsInNwb3RpZnkiLCJkaWdpdHMiLCJqYW5yYWluZW5nYWdlIiwiamFucmFpbmNhcHR1cmUiLCJ2a29udGFrdGUiLCJxcSIsIndlY2hhdCIsIndlaWJvIiwiYW5vbnltb3VzIiwidmFsaWRhdGVBdXRoRGF0YSIsIlByb21pc2UiLCJyZXNvbHZlIiwidmFsaWRhdGVBcHBJZCIsInByb3ZpZGVycyIsImF1dGhEYXRhVmFsaWRhdG9yIiwiYWRhcHRlciIsImFwcElkcyIsIm9wdGlvbnMiLCJhdXRoRGF0YSIsInRoZW4iLCJsb2FkQXV0aEFkYXB0ZXIiLCJwcm92aWRlciIsImF1dGhPcHRpb25zIiwiZGVmYXVsdEFkYXB0ZXIiLCJPYmplY3QiLCJhc3NpZ24iLCJwcm92aWRlck9wdGlvbnMiLCJ1bmRlZmluZWQiLCJvcHRpb25hbEFkYXB0ZXIiLCJmb3JFYWNoIiwia2V5IiwibW9kdWxlIiwiZXhwb3J0cyIsImVuYWJsZUFub255bW91c1VzZXJzIiwiX2VuYWJsZUFub255bW91c1VzZXJzIiwic2V0RW5hYmxlQW5vbnltb3VzVXNlcnMiLCJlbmFibGUiLCJnZXRWYWxpZGF0b3JGb3JQcm92aWRlciIsImZyZWV6ZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7O0FBRUEsTUFBTUEsV0FBV0MsUUFBUSxZQUFSLENBQWpCO0FBQ0EsTUFBTUMscUJBQXFCRCxRQUFRLHNCQUFSLENBQTNCO0FBQ0EsTUFBTUUsWUFBWUYsUUFBUSxhQUFSLENBQWxCO0FBQ0EsTUFBTUcsV0FBV0gsUUFBUSxZQUFSLENBQWpCO0FBQ0EsTUFBTUksU0FBU0osUUFBUSxVQUFSLENBQWY7QUFDQSxNQUFNSyxTQUFTTCxRQUFRLFVBQVIsQ0FBZjtBQUNBLE1BQU1NLFNBQVNOLFFBQVEsVUFBUixDQUFmO0FBQ0EsTUFBTU8sVUFBVVAsUUFBUSxXQUFSLENBQWhCO0FBQ0EsTUFBTVEsVUFBVVIsUUFBUSxXQUFSLENBQWhCO0FBQ0EsTUFBTVMsU0FBU1QsUUFBUSxXQUFSLENBQWYsQyxDQUFxQztBQUNyQyxNQUFNVSxnQkFBZ0JWLFFBQVEsaUJBQVIsQ0FBdEI7QUFDQSxNQUFNVyxpQkFBaUJYLFFBQVEsa0JBQVIsQ0FBdkI7QUFDQSxNQUFNWSxZQUFZWixRQUFRLGFBQVIsQ0FBbEI7QUFDQSxNQUFNYSxLQUFLYixRQUFRLE1BQVIsQ0FBWDtBQUNBLE1BQU1jLFNBQVNkLFFBQVEsVUFBUixDQUFmO0FBQ0EsTUFBTWUsUUFBUWYsUUFBUSxTQUFSLENBQWQ7O0FBRUEsTUFBTWdCLFlBQVk7QUFDaEJDLG9CQUFrQixNQUFNO0FBQ3RCLFdBQU9DLFFBQVFDLE9BQVIsRUFBUDtBQUNELEdBSGU7QUFJaEJDLGlCQUFlLE1BQU07QUFDbkIsV0FBT0YsUUFBUUMsT0FBUixFQUFQO0FBQ0Q7QUFOZSxDQUFsQjs7QUFTQSxNQUFNRSxZQUFZO0FBQ2hCdEIsVUFEZ0I7QUFFaEJFLG9CQUZnQjtBQUdoQkMsV0FIZ0I7QUFJaEJDLFVBSmdCO0FBS2hCQyxRQUxnQjtBQU1oQkMsUUFOZ0I7QUFPaEJDLFFBUGdCO0FBUWhCQyxTQVJnQjtBQVNoQkMsU0FUZ0I7QUFVaEJRLFdBVmdCO0FBV2hCUCxRQVhnQjtBQVloQkMsZUFaZ0I7QUFhaEJDLGdCQWJnQjtBQWNoQkMsV0FkZ0I7QUFlaEJDLElBZmdCO0FBZ0JoQkMsUUFoQmdCO0FBaUJoQkM7QUFqQmdCLENBQWxCO0FBbUJBLFNBQVNPLGlCQUFULENBQTJCQyxPQUEzQixFQUFvQ0MsTUFBcEMsRUFBNENDLE9BQTVDLEVBQXFEO0FBQ25ELFNBQU8sVUFBU0MsUUFBVCxFQUFtQjtBQUN4QixXQUFPSCxRQUFRTixnQkFBUixDQUF5QlMsUUFBekIsRUFBbUNELE9BQW5DLEVBQTRDRSxJQUE1QyxDQUFpRCxNQUFNO0FBQzVELFVBQUlILE1BQUosRUFBWTtBQUNWLGVBQU9ELFFBQVFILGFBQVIsQ0FBc0JJLE1BQXRCLEVBQThCRSxRQUE5QixFQUF3Q0QsT0FBeEMsQ0FBUDtBQUNEO0FBQ0QsYUFBT1AsUUFBUUMsT0FBUixFQUFQO0FBQ0QsS0FMTSxDQUFQO0FBTUQsR0FQRDtBQVFEOztBQUVELFNBQVNTLGVBQVQsQ0FBeUJDLFFBQXpCLEVBQW1DQyxXQUFuQyxFQUFnRDtBQUM5QyxRQUFNQyxpQkFBaUJWLFVBQVVRLFFBQVYsQ0FBdkI7QUFDQSxRQUFNTixVQUFVUyxPQUFPQyxNQUFQLENBQWMsRUFBZCxFQUFrQkYsY0FBbEIsQ0FBaEI7QUFDQSxRQUFNRyxrQkFBa0JKLFlBQVlELFFBQVosQ0FBeEI7O0FBRUEsTUFBSSxDQUFDRSxjQUFELElBQW1CLENBQUNHLGVBQXhCLEVBQXlDO0FBQ3ZDO0FBQ0Q7O0FBRUQsUUFBTVYsU0FBU1Usa0JBQWtCQSxnQkFBZ0JWLE1BQWxDLEdBQTJDVyxTQUExRDs7QUFFQTtBQUNBLE1BQUlELGVBQUosRUFBcUI7QUFDbkIsVUFBTUUsa0JBQWtCLDZCQUFZRixlQUFaLEVBQTZCQyxTQUE3QixFQUF3Q0QsZUFBeEMsQ0FBeEI7QUFDQSxRQUFJRSxlQUFKLEVBQXFCO0FBQ25CLE9BQUMsa0JBQUQsRUFBcUIsZUFBckIsRUFBc0NDLE9BQXRDLENBQStDQyxHQUFELElBQVM7QUFDckQsWUFBSUYsZ0JBQWdCRSxHQUFoQixDQUFKLEVBQTBCO0FBQ3hCZixrQkFBUWUsR0FBUixJQUFlRixnQkFBZ0JFLEdBQWhCLENBQWY7QUFDRDtBQUNGLE9BSkQ7QUFLRDtBQUNGOztBQUVELE1BQUksQ0FBQ2YsUUFBUU4sZ0JBQVQsSUFBNkIsQ0FBQ00sUUFBUUgsYUFBMUMsRUFBeUQ7QUFDdkQ7QUFDRDs7QUFFRCxTQUFPLEVBQUNHLE9BQUQsRUFBVUMsTUFBVixFQUFrQlUsZUFBbEIsRUFBUDtBQUNEOztBQUVESyxPQUFPQyxPQUFQLEdBQWlCLFVBQVNWLGNBQWMsRUFBdkIsRUFBMkJXLHVCQUF1QixJQUFsRCxFQUF3RDtBQUN2RSxNQUFJQyx3QkFBd0JELG9CQUE1QjtBQUNBLFFBQU1FLDBCQUEwQixVQUFTQyxNQUFULEVBQWlCO0FBQy9DRiw0QkFBd0JFLE1BQXhCO0FBQ0QsR0FGRDtBQUdBO0FBQ0EsUUFBTUMsMEJBQTBCLFVBQVNoQixRQUFULEVBQW1COztBQUVqRCxRQUFJQSxhQUFhLFdBQWIsSUFBNEIsQ0FBQ2EscUJBQWpDLEVBQXdEO0FBQ3REO0FBQ0Q7O0FBRUQsVUFBTTtBQUNKbkIsYUFESTtBQUVKQyxZQUZJO0FBR0pVO0FBSEksUUFJRk4sZ0JBQWdCQyxRQUFoQixFQUEwQkMsV0FBMUIsQ0FKSjs7QUFNQSxXQUFPUixrQkFBa0JDLE9BQWxCLEVBQTJCQyxNQUEzQixFQUFtQ1UsZUFBbkMsQ0FBUDtBQUNELEdBYkQ7O0FBZUEsU0FBT0YsT0FBT2MsTUFBUCxDQUFjO0FBQ25CRCwyQkFEbUI7QUFFbkJGO0FBRm1CLEdBQWQsQ0FBUDtBQUlELENBekJEOztBQTJCQUosT0FBT0MsT0FBUCxDQUFlWixlQUFmLEdBQWlDQSxlQUFqQyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2FkQWRhcHRlciBmcm9tICcuLi9BZGFwdGVyTG9hZGVyJztcblxuY29uc3QgZmFjZWJvb2sgPSByZXF1aXJlKCcuL2ZhY2Vib29rJyk7XG5jb25zdCBmYWNlYm9va2FjY291bnRraXQgPSByZXF1aXJlKCcuL2ZhY2Vib29rYWNjb3VudGtpdCcpO1xuY29uc3QgaW5zdGFncmFtID0gcmVxdWlyZShcIi4vaW5zdGFncmFtXCIpO1xuY29uc3QgbGlua2VkaW4gPSByZXF1aXJlKFwiLi9saW5rZWRpblwiKTtcbmNvbnN0IG1lZXR1cCA9IHJlcXVpcmUoXCIuL21lZXR1cFwiKTtcbmNvbnN0IGdvb2dsZSA9IHJlcXVpcmUoXCIuL2dvb2dsZVwiKTtcbmNvbnN0IGdpdGh1YiA9IHJlcXVpcmUoXCIuL2dpdGh1YlwiKTtcbmNvbnN0IHR3aXR0ZXIgPSByZXF1aXJlKFwiLi90d2l0dGVyXCIpO1xuY29uc3Qgc3BvdGlmeSA9IHJlcXVpcmUoXCIuL3Nwb3RpZnlcIik7XG5jb25zdCBkaWdpdHMgPSByZXF1aXJlKFwiLi90d2l0dGVyXCIpOyAvLyBkaWdpdHMgdG9rZW5zIGFyZSB2YWxpZGF0ZWQgYnkgdHdpdHRlclxuY29uc3QgamFucmFpbmVuZ2FnZSA9IHJlcXVpcmUoXCIuL2phbnJhaW5lbmdhZ2VcIik7XG5jb25zdCBqYW5yYWluY2FwdHVyZSA9IHJlcXVpcmUoXCIuL2phbnJhaW5jYXB0dXJlXCIpO1xuY29uc3QgdmtvbnRha3RlID0gcmVxdWlyZShcIi4vdmtvbnRha3RlXCIpO1xuY29uc3QgcXEgPSByZXF1aXJlKFwiLi9xcVwiKTtcbmNvbnN0IHdlY2hhdCA9IHJlcXVpcmUoXCIuL3dlY2hhdFwiKTtcbmNvbnN0IHdlaWJvID0gcmVxdWlyZShcIi4vd2VpYm9cIik7XG5cbmNvbnN0IGFub255bW91cyA9IHtcbiAgdmFsaWRhdGVBdXRoRGF0YTogKCkgPT4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfSxcbiAgdmFsaWRhdGVBcHBJZDogKCkgPT4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxufVxuXG5jb25zdCBwcm92aWRlcnMgPSB7XG4gIGZhY2Vib29rLFxuICBmYWNlYm9va2FjY291bnRraXQsXG4gIGluc3RhZ3JhbSxcbiAgbGlua2VkaW4sXG4gIG1lZXR1cCxcbiAgZ29vZ2xlLFxuICBnaXRodWIsXG4gIHR3aXR0ZXIsXG4gIHNwb3RpZnksXG4gIGFub255bW91cyxcbiAgZGlnaXRzLFxuICBqYW5yYWluZW5nYWdlLFxuICBqYW5yYWluY2FwdHVyZSxcbiAgdmtvbnRha3RlLFxuICBxcSxcbiAgd2VjaGF0LFxuICB3ZWlib1xufVxuZnVuY3Rpb24gYXV0aERhdGFWYWxpZGF0b3IoYWRhcHRlciwgYXBwSWRzLCBvcHRpb25zKSB7XG4gIHJldHVybiBmdW5jdGlvbihhdXRoRGF0YSkge1xuICAgIHJldHVybiBhZGFwdGVyLnZhbGlkYXRlQXV0aERhdGEoYXV0aERhdGEsIG9wdGlvbnMpLnRoZW4oKCkgPT4ge1xuICAgICAgaWYgKGFwcElkcykge1xuICAgICAgICByZXR1cm4gYWRhcHRlci52YWxpZGF0ZUFwcElkKGFwcElkcywgYXV0aERhdGEsIG9wdGlvbnMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGxvYWRBdXRoQWRhcHRlcihwcm92aWRlciwgYXV0aE9wdGlvbnMpIHtcbiAgY29uc3QgZGVmYXVsdEFkYXB0ZXIgPSBwcm92aWRlcnNbcHJvdmlkZXJdO1xuICBjb25zdCBhZGFwdGVyID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdEFkYXB0ZXIpO1xuICBjb25zdCBwcm92aWRlck9wdGlvbnMgPSBhdXRoT3B0aW9uc1twcm92aWRlcl07XG5cbiAgaWYgKCFkZWZhdWx0QWRhcHRlciAmJiAhcHJvdmlkZXJPcHRpb25zKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYXBwSWRzID0gcHJvdmlkZXJPcHRpb25zID8gcHJvdmlkZXJPcHRpb25zLmFwcElkcyA6IHVuZGVmaW5lZDtcblxuICAvLyBUcnkgdGhlIGNvbmZpZ3VyYXRpb24gbWV0aG9kc1xuICBpZiAocHJvdmlkZXJPcHRpb25zKSB7XG4gICAgY29uc3Qgb3B0aW9uYWxBZGFwdGVyID0gbG9hZEFkYXB0ZXIocHJvdmlkZXJPcHRpb25zLCB1bmRlZmluZWQsIHByb3ZpZGVyT3B0aW9ucyk7XG4gICAgaWYgKG9wdGlvbmFsQWRhcHRlcikge1xuICAgICAgWyd2YWxpZGF0ZUF1dGhEYXRhJywgJ3ZhbGlkYXRlQXBwSWQnXS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgaWYgKG9wdGlvbmFsQWRhcHRlcltrZXldKSB7XG4gICAgICAgICAgYWRhcHRlcltrZXldID0gb3B0aW9uYWxBZGFwdGVyW2tleV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGlmICghYWRhcHRlci52YWxpZGF0ZUF1dGhEYXRhIHx8ICFhZGFwdGVyLnZhbGlkYXRlQXBwSWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICByZXR1cm4ge2FkYXB0ZXIsIGFwcElkcywgcHJvdmlkZXJPcHRpb25zfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhdXRoT3B0aW9ucyA9IHt9LCBlbmFibGVBbm9ueW1vdXNVc2VycyA9IHRydWUpIHtcbiAgbGV0IF9lbmFibGVBbm9ueW1vdXNVc2VycyA9IGVuYWJsZUFub255bW91c1VzZXJzO1xuICBjb25zdCBzZXRFbmFibGVBbm9ueW1vdXNVc2VycyA9IGZ1bmN0aW9uKGVuYWJsZSkge1xuICAgIF9lbmFibGVBbm9ueW1vdXNVc2VycyA9IGVuYWJsZTtcbiAgfVxuICAvLyBUbyBoYW5kbGUgdGhlIHRlc3QgY2FzZXMgb24gY29uZmlndXJhdGlvblxuICBjb25zdCBnZXRWYWxpZGF0b3JGb3JQcm92aWRlciA9IGZ1bmN0aW9uKHByb3ZpZGVyKSB7XG5cbiAgICBpZiAocHJvdmlkZXIgPT09ICdhbm9ueW1vdXMnICYmICFfZW5hYmxlQW5vbnltb3VzVXNlcnMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBhZGFwdGVyLFxuICAgICAgYXBwSWRzLFxuICAgICAgcHJvdmlkZXJPcHRpb25zXG4gICAgfSA9IGxvYWRBdXRoQWRhcHRlcihwcm92aWRlciwgYXV0aE9wdGlvbnMpO1xuXG4gICAgcmV0dXJuIGF1dGhEYXRhVmFsaWRhdG9yKGFkYXB0ZXIsIGFwcElkcywgcHJvdmlkZXJPcHRpb25zKTtcbiAgfVxuXG4gIHJldHVybiBPYmplY3QuZnJlZXplKHtcbiAgICBnZXRWYWxpZGF0b3JGb3JQcm92aWRlcixcbiAgICBzZXRFbmFibGVBbm9ueW1vdXNVc2Vyc1xuICB9KVxufVxuXG5tb2R1bGUuZXhwb3J0cy5sb2FkQXV0aEFkYXB0ZXIgPSBsb2FkQXV0aEFkYXB0ZXI7XG4iXX0=
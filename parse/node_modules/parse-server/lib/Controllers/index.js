'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getControllers = getControllers;
exports.getLoggerController = getLoggerController;
exports.getFilesController = getFilesController;
exports.getUserController = getUserController;
exports.getCacheController = getCacheController;
exports.getAnalyticsController = getAnalyticsController;
exports.getLiveQueryController = getLiveQueryController;
exports.getDatabaseController = getDatabaseController;
exports.getHooksController = getHooksController;
exports.getPushController = getPushController;
exports.getAuthDataManager = getAuthDataManager;
exports.getDatabaseAdapter = getDatabaseAdapter;

var _Auth = require('../Adapters/Auth');

var _Auth2 = _interopRequireDefault(_Auth);

var _Options = require('../Options');

var _AdapterLoader = require('../Adapters/AdapterLoader');

var _defaults = require('../defaults');

var _defaults2 = _interopRequireDefault(_defaults);

var _url = require('url');

var _url2 = _interopRequireDefault(_url);

var _LoggerController = require('./LoggerController');

var _FilesController = require('./FilesController');

var _HooksController = require('./HooksController');

var _UserController = require('./UserController');

var _CacheController = require('./CacheController');

var _LiveQueryController = require('./LiveQueryController');

var _AnalyticsController = require('./AnalyticsController');

var _PushController = require('./PushController');

var _PushQueue = require('../Push/PushQueue');

var _PushWorker = require('../Push/PushWorker');

var _DatabaseController = require('./DatabaseController');

var _DatabaseController2 = _interopRequireDefault(_DatabaseController);

var _SchemaCache = require('./SchemaCache');

var _SchemaCache2 = _interopRequireDefault(_SchemaCache);

var _GridStoreAdapter = require('../Adapters/Files/GridStoreAdapter');

var _WinstonLoggerAdapter = require('../Adapters/Logger/WinstonLoggerAdapter');

var _InMemoryCacheAdapter = require('../Adapters/Cache/InMemoryCacheAdapter');

var _AnalyticsAdapter = require('../Adapters/Analytics/AnalyticsAdapter');

var _MongoStorageAdapter = require('../Adapters/Storage/Mongo/MongoStorageAdapter');

var _MongoStorageAdapter2 = _interopRequireDefault(_MongoStorageAdapter);

var _PostgresStorageAdapter = require('../Adapters/Storage/Postgres/PostgresStorageAdapter');

var _PostgresStorageAdapter2 = _interopRequireDefault(_PostgresStorageAdapter);

var _pushAdapter = require('@parse/push-adapter');

var _pushAdapter2 = _interopRequireDefault(_pushAdapter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getControllers(options) {
  const loggerController = getLoggerController(options);
  const filesController = getFilesController(options);
  const userController = getUserController(options);
  const {
    pushController,
    hasPushScheduledSupport,
    hasPushSupport,
    pushControllerQueue,
    pushWorker
  } = getPushController(options);
  const cacheController = getCacheController(options);
  const analyticsController = getAnalyticsController(options);
  const liveQueryController = getLiveQueryController(options);
  const databaseController = getDatabaseController(options, cacheController);
  const hooksController = getHooksController(options, databaseController);
  const authDataManager = getAuthDataManager(options);
  return {
    loggerController,
    filesController,
    userController,
    pushController,
    hasPushScheduledSupport,
    hasPushSupport,
    pushWorker,
    pushControllerQueue,
    analyticsController,
    cacheController,
    liveQueryController,
    databaseController,
    hooksController,
    authDataManager
  };
}

// Adapters

// Controllers
function getLoggerController(options) {
  const {
    appId,
    jsonLogs,
    logsFolder,
    verbose,
    logLevel,
    silent,
    loggerAdapter
  } = options;
  const loggerOptions = { jsonLogs, logsFolder, verbose, logLevel, silent };
  const loggerControllerAdapter = (0, _AdapterLoader.loadAdapter)(loggerAdapter, _WinstonLoggerAdapter.WinstonLoggerAdapter, loggerOptions);
  return new _LoggerController.LoggerController(loggerControllerAdapter, appId, loggerOptions);
}

function getFilesController(options) {
  const {
    appId,
    databaseURI,
    filesAdapter,
    databaseAdapter,
    preserveFileName
  } = options;
  if (!filesAdapter && databaseAdapter) {
    throw 'When using an explicit database adapter, you must also use an explicit filesAdapter.';
  }
  const filesControllerAdapter = (0, _AdapterLoader.loadAdapter)(filesAdapter, () => {
    return new _GridStoreAdapter.GridStoreAdapter(databaseURI);
  });
  return new _FilesController.FilesController(filesControllerAdapter, appId, { preserveFileName });
}

function getUserController(options) {
  const {
    appId,
    emailAdapter,
    verifyUserEmails
  } = options;
  const emailControllerAdapter = (0, _AdapterLoader.loadAdapter)(emailAdapter);
  return new _UserController.UserController(emailControllerAdapter, appId, { verifyUserEmails });
}

function getCacheController(options) {
  const {
    appId,
    cacheAdapter,
    cacheTTL,
    cacheMaxSize
  } = options;
  const cacheControllerAdapter = (0, _AdapterLoader.loadAdapter)(cacheAdapter, _InMemoryCacheAdapter.InMemoryCacheAdapter, { appId: appId, ttl: cacheTTL, maxSize: cacheMaxSize });
  return new _CacheController.CacheController(cacheControllerAdapter, appId);
}

function getAnalyticsController(options) {
  const {
    analyticsAdapter
  } = options;
  const analyticsControllerAdapter = (0, _AdapterLoader.loadAdapter)(analyticsAdapter, _AnalyticsAdapter.AnalyticsAdapter);
  return new _AnalyticsController.AnalyticsController(analyticsControllerAdapter);
}

function getLiveQueryController(options) {
  return new _LiveQueryController.LiveQueryController(options.liveQuery);
}

function getDatabaseController(options, cacheController) {
  const {
    databaseURI,
    databaseOptions,
    collectionPrefix,
    schemaCacheTTL,
    enableSingleSchemaCache
  } = options;
  let {
    databaseAdapter
  } = options;
  if ((databaseOptions || databaseURI && databaseURI !== _defaults2.default.databaseURI || collectionPrefix !== _defaults2.default.collectionPrefix) && databaseAdapter) {
    throw 'You cannot specify both a databaseAdapter and a databaseURI/databaseOptions/collectionPrefix.';
  } else if (!databaseAdapter) {
    databaseAdapter = getDatabaseAdapter(databaseURI, collectionPrefix, databaseOptions);
  } else {
    databaseAdapter = (0, _AdapterLoader.loadAdapter)(databaseAdapter);
  }
  return new _DatabaseController2.default(databaseAdapter, new _SchemaCache2.default(cacheController, schemaCacheTTL, enableSingleSchemaCache));
}

function getHooksController(options, databaseController) {
  const {
    appId,
    webhookKey
  } = options;
  return new _HooksController.HooksController(appId, databaseController, webhookKey);
}

function getPushController(options) {
  const {
    scheduledPush,
    push
  } = options;

  const pushOptions = Object.assign({}, push);
  const pushQueueOptions = pushOptions.queueOptions || {};
  if (pushOptions.queueOptions) {
    delete pushOptions.queueOptions;
  }

  // Pass the push options too as it works with the default
  const pushAdapter = (0, _AdapterLoader.loadAdapter)(pushOptions && pushOptions.adapter, _pushAdapter2.default, pushOptions);
  // We pass the options and the base class for the adatper,
  // Note that passing an instance would work too
  const pushController = new _PushController.PushController();
  const hasPushSupport = !!(pushAdapter && push);
  const hasPushScheduledSupport = hasPushSupport && scheduledPush === true;

  const {
    disablePushWorker
  } = pushQueueOptions;

  const pushControllerQueue = new _PushQueue.PushQueue(pushQueueOptions);
  let pushWorker;
  if (!disablePushWorker) {
    pushWorker = new _PushWorker.PushWorker(pushAdapter, pushQueueOptions);
  }
  return {
    pushController,
    hasPushSupport,
    hasPushScheduledSupport,
    pushControllerQueue,
    pushWorker
  };
}

function getAuthDataManager(options) {
  const {
    auth,
    enableAnonymousUsers
  } = options;
  return (0, _Auth2.default)(auth, enableAnonymousUsers);
}

function getDatabaseAdapter(databaseURI, collectionPrefix, databaseOptions) {
  let protocol;
  try {
    const parsedURI = _url2.default.parse(databaseURI);
    protocol = parsedURI.protocol ? parsedURI.protocol.toLowerCase() : null;
  } catch (e) {/* */}
  switch (protocol) {
    case 'postgres:':
      return new _PostgresStorageAdapter2.default({
        uri: databaseURI,
        collectionPrefix,
        databaseOptions
      });
    default:
      return new _MongoStorageAdapter2.default({
        uri: databaseURI,
        collectionPrefix,
        mongoOptions: databaseOptions
      });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9pbmRleC5qcyJdLCJuYW1lcyI6WyJnZXRDb250cm9sbGVycyIsImdldExvZ2dlckNvbnRyb2xsZXIiLCJnZXRGaWxlc0NvbnRyb2xsZXIiLCJnZXRVc2VyQ29udHJvbGxlciIsImdldENhY2hlQ29udHJvbGxlciIsImdldEFuYWx5dGljc0NvbnRyb2xsZXIiLCJnZXRMaXZlUXVlcnlDb250cm9sbGVyIiwiZ2V0RGF0YWJhc2VDb250cm9sbGVyIiwiZ2V0SG9va3NDb250cm9sbGVyIiwiZ2V0UHVzaENvbnRyb2xsZXIiLCJnZXRBdXRoRGF0YU1hbmFnZXIiLCJnZXREYXRhYmFzZUFkYXB0ZXIiLCJvcHRpb25zIiwibG9nZ2VyQ29udHJvbGxlciIsImZpbGVzQ29udHJvbGxlciIsInVzZXJDb250cm9sbGVyIiwicHVzaENvbnRyb2xsZXIiLCJoYXNQdXNoU2NoZWR1bGVkU3VwcG9ydCIsImhhc1B1c2hTdXBwb3J0IiwicHVzaENvbnRyb2xsZXJRdWV1ZSIsInB1c2hXb3JrZXIiLCJjYWNoZUNvbnRyb2xsZXIiLCJhbmFseXRpY3NDb250cm9sbGVyIiwibGl2ZVF1ZXJ5Q29udHJvbGxlciIsImRhdGFiYXNlQ29udHJvbGxlciIsImhvb2tzQ29udHJvbGxlciIsImF1dGhEYXRhTWFuYWdlciIsImFwcElkIiwianNvbkxvZ3MiLCJsb2dzRm9sZGVyIiwidmVyYm9zZSIsImxvZ0xldmVsIiwic2lsZW50IiwibG9nZ2VyQWRhcHRlciIsImxvZ2dlck9wdGlvbnMiLCJsb2dnZXJDb250cm9sbGVyQWRhcHRlciIsIldpbnN0b25Mb2dnZXJBZGFwdGVyIiwiTG9nZ2VyQ29udHJvbGxlciIsImRhdGFiYXNlVVJJIiwiZmlsZXNBZGFwdGVyIiwiZGF0YWJhc2VBZGFwdGVyIiwicHJlc2VydmVGaWxlTmFtZSIsImZpbGVzQ29udHJvbGxlckFkYXB0ZXIiLCJHcmlkU3RvcmVBZGFwdGVyIiwiRmlsZXNDb250cm9sbGVyIiwiZW1haWxBZGFwdGVyIiwidmVyaWZ5VXNlckVtYWlscyIsImVtYWlsQ29udHJvbGxlckFkYXB0ZXIiLCJVc2VyQ29udHJvbGxlciIsImNhY2hlQWRhcHRlciIsImNhY2hlVFRMIiwiY2FjaGVNYXhTaXplIiwiY2FjaGVDb250cm9sbGVyQWRhcHRlciIsIkluTWVtb3J5Q2FjaGVBZGFwdGVyIiwidHRsIiwibWF4U2l6ZSIsIkNhY2hlQ29udHJvbGxlciIsImFuYWx5dGljc0FkYXB0ZXIiLCJhbmFseXRpY3NDb250cm9sbGVyQWRhcHRlciIsIkFuYWx5dGljc0FkYXB0ZXIiLCJBbmFseXRpY3NDb250cm9sbGVyIiwiTGl2ZVF1ZXJ5Q29udHJvbGxlciIsImxpdmVRdWVyeSIsImRhdGFiYXNlT3B0aW9ucyIsImNvbGxlY3Rpb25QcmVmaXgiLCJzY2hlbWFDYWNoZVRUTCIsImVuYWJsZVNpbmdsZVNjaGVtYUNhY2hlIiwiZGVmYXVsdHMiLCJEYXRhYmFzZUNvbnRyb2xsZXIiLCJTY2hlbWFDYWNoZSIsIndlYmhvb2tLZXkiLCJIb29rc0NvbnRyb2xsZXIiLCJzY2hlZHVsZWRQdXNoIiwicHVzaCIsInB1c2hPcHRpb25zIiwiT2JqZWN0IiwiYXNzaWduIiwicHVzaFF1ZXVlT3B0aW9ucyIsInF1ZXVlT3B0aW9ucyIsInB1c2hBZGFwdGVyIiwiYWRhcHRlciIsIlBhcnNlUHVzaEFkYXB0ZXIiLCJQdXNoQ29udHJvbGxlciIsImRpc2FibGVQdXNoV29ya2VyIiwiUHVzaFF1ZXVlIiwiUHVzaFdvcmtlciIsImF1dGgiLCJlbmFibGVBbm9ueW1vdXNVc2VycyIsInByb3RvY29sIiwicGFyc2VkVVJJIiwidXJsIiwicGFyc2UiLCJ0b0xvd2VyQ2FzZSIsImUiLCJQb3N0Z3Jlc1N0b3JhZ2VBZGFwdGVyIiwidXJpIiwiTW9uZ29TdG9yYWdlQWRhcHRlciIsIm1vbmdvT3B0aW9ucyJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUE0QmdCQSxjLEdBQUFBLGM7UUFtQ0FDLG1CLEdBQUFBLG1CO1FBZUFDLGtCLEdBQUFBLGtCO1FBaUJBQyxp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QUtGO0FBQ0UsYUFBTyxJQUFJaUMsNkJBQUosQ0FBd0I7QUFDN0JELGFBQUt6RCxXQUR3QjtBQUU3QjBCLHdCQUY2QjtBQUc3QmlDLHNCQUFjbEM7QUFIZSxPQUF4QixDQUFQO0FBUkY7QUFjRCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhdXRoRGF0YU1hbmFnZXIgICAgICAgICAgZnJvbSAnLi4vQWRhcHRlcnMvQXV0aCc7XG5pbXBvcnQgeyBQYXJzZVNlcnZlck9wdGlvbnMgfSAgIGZyb20gJy4uL09wdGlvbnMnO1xuaW1wb3J0IHsgbG9hZEFkYXB0ZXIgfSAgICAgICAgICBmcm9tICcuLi9BZGFwdGVycy9BZGFwdGVyTG9hZGVyJztcbmltcG9ydCBkZWZhdWx0cyAgICAgICAgICAgICAgICAgZnJvbSAnLi4vZGVmYXVsdHMnO1xuaW1wb3J0IHVybCAgICAgICAgICAgICAgICAgICAgICBmcm9tICd1cmwnO1xuLy8gQ29udHJvbGxlcnNcbmltcG9ydCB7IExvZ2dlckNvbnRyb2xsZXIgfSAgICAgZnJvbSAnLi9Mb2dnZXJDb250cm9sbGVyJztcbmltcG9ydCB7IEZpbGVzQ29udHJvbGxlciB9ICAgICAgZnJvbSAnLi9GaWxlc0NvbnRyb2xsZXInO1xuaW1wb3J0IHsgSG9va3NDb250cm9sbGVyIH0gICAgICBmcm9tICcuL0hvb2tzQ29udHJvbGxlcic7XG5pbXBvcnQgeyBVc2VyQ29udHJvbGxlciB9ICAgICAgIGZyb20gJy4vVXNlckNvbnRyb2xsZXInO1xuaW1wb3J0IHsgQ2FjaGVDb250cm9sbGVyIH0gICAgICBmcm9tICcuL0NhY2hlQ29udHJvbGxlcic7XG5pbXBvcnQgeyBMaXZlUXVlcnlDb250cm9sbGVyIH0gIGZyb20gJy4vTGl2ZVF1ZXJ5Q29udHJvbGxlcic7XG5pbXBvcnQgeyBBbmFseXRpY3NDb250cm9sbGVyIH0gIGZyb20gJy4vQW5hbHl0aWNzQ29udHJvbGxlcic7XG5pbXBvcnQgeyBQdXNoQ29udHJvbGxlciB9ICAgICAgIGZyb20gJy4vUHVzaENvbnRyb2xsZXInO1xuaW1wb3J0IHsgUHVzaFF1ZXVlIH0gICAgICAgICAgICBmcm9tICcuLi9QdXNoL1B1c2hRdWV1ZSc7XG5pbXBvcnQgeyBQdXNoV29ya2VyIH0gICAgICAgICAgIGZyb20gJy4uL1B1c2gvUHVzaFdvcmtlcic7XG5pbXBvcnQgRGF0YWJhc2VDb250cm9sbGVyICAgICAgIGZyb20gJy4vRGF0YWJhc2VDb250cm9sbGVyJztcbmltcG9ydCBTY2hlbWFDYWNoZSAgICAgICAgICAgICAgZnJvbSAnLi9TY2hlbWFDYWNoZSc7XG5cbi8vIEFkYXB0ZXJzXG5pbXBvcnQgeyBHcmlkU3RvcmVBZGFwdGVyIH0gICAgIGZyb20gJy4uL0FkYXB0ZXJzL0ZpbGVzL0dyaWRTdG9yZUFkYXB0ZXInO1xuaW1wb3J0IHsgV2luc3RvbkxvZ2dlckFkYXB0ZXIgfSBmcm9tICcuLi9BZGFwdGVycy9Mb2dnZXIvV2luc3RvbkxvZ2dlckFkYXB0ZXInO1xuaW1wb3J0IHsgSW5NZW1vcnlDYWNoZUFkYXB0ZXIgfSBmcm9tICcuLi9BZGFwdGVycy9DYWNoZS9Jbk1lbW9yeUNhY2hlQWRhcHRlcic7XG5pbXBvcnQgeyBBbmFseXRpY3NBZGFwdGVyIH0gICAgIGZyb20gJy4uL0FkYXB0ZXJzL0FuYWx5dGljcy9BbmFseXRpY3NBZGFwdGVyJztcbmltcG9ydCBNb25nb1N0b3JhZ2VBZGFwdGVyICAgICAgZnJvbSAnLi4vQWRhcHRlcnMvU3RvcmFnZS9Nb25nby9Nb25nb1N0b3JhZ2VBZGFwdGVyJztcbmltcG9ydCBQb3N0Z3Jlc1N0b3JhZ2VBZGFwdGVyICAgZnJvbSAnLi4vQWRhcHRlcnMvU3RvcmFnZS9Qb3N0Z3Jlcy9Qb3N0Z3Jlc1N0b3JhZ2VBZGFwdGVyJztcbmltcG9ydCBQYXJzZVB1c2hBZGFwdGVyICAgICAgICAgZnJvbSAnQHBhcnNlL3B1c2gtYWRhcHRlcic7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb250cm9sbGVycyhvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMpIHtcbiAgY29uc3QgbG9nZ2VyQ29udHJvbGxlciA9IGdldExvZ2dlckNvbnRyb2xsZXIob3B0aW9ucyk7XG4gIGNvbnN0IGZpbGVzQ29udHJvbGxlciA9IGdldEZpbGVzQ29udHJvbGxlcihvcHRpb25zKTtcbiAgY29uc3QgdXNlckNvbnRyb2xsZXIgPSBnZXRVc2VyQ29udHJvbGxlcihvcHRpb25zKTtcbiAgY29uc3Qge1xuICAgIHB1c2hDb250cm9sbGVyLFxuICAgIGhhc1B1c2hTY2hlZHVsZWRTdXBwb3J0LFxuICAgIGhhc1B1c2hTdXBwb3J0LFxuICAgIHB1c2hDb250cm9sbGVyUXVldWUsXG4gICAgcHVzaFdvcmtlclxuICB9ID0gZ2V0UHVzaENvbnRyb2xsZXIob3B0aW9ucyk7XG4gIGNvbnN0IGNhY2hlQ29udHJvbGxlciA9IGdldENhY2hlQ29udHJvbGxlcihvcHRpb25zKTtcbiAgY29uc3QgYW5hbHl0aWNzQ29udHJvbGxlciA9IGdldEFuYWx5dGljc0NvbnRyb2xsZXIob3B0aW9ucyk7XG4gIGNvbnN0IGxpdmVRdWVyeUNvbnRyb2xsZXIgPSBnZXRMaXZlUXVlcnlDb250cm9sbGVyKG9wdGlvbnMpO1xuICBjb25zdCBkYXRhYmFzZUNvbnRyb2xsZXIgPSBnZXREYXRhYmFzZUNvbnRyb2xsZXIob3B0aW9ucywgY2FjaGVDb250cm9sbGVyKTtcbiAgY29uc3QgaG9va3NDb250cm9sbGVyID0gZ2V0SG9va3NDb250cm9sbGVyKG9wdGlvbnMsIGRhdGFiYXNlQ29udHJvbGxlcik7XG4gIGNvbnN0IGF1dGhEYXRhTWFuYWdlciA9IGdldEF1dGhEYXRhTWFuYWdlcihvcHRpb25zKTtcbiAgcmV0dXJuIHtcbiAgICBsb2dnZXJDb250cm9sbGVyLFxuICAgIGZpbGVzQ29udHJvbGxlcixcbiAgICB1c2VyQ29udHJvbGxlcixcbiAgICBwdXNoQ29udHJvbGxlcixcbiAgICBoYXNQdXNoU2NoZWR1bGVkU3VwcG9ydCxcbiAgICBoYXNQdXNoU3VwcG9ydCxcbiAgICBwdXNoV29ya2VyLFxuICAgIHB1c2hDb250cm9sbGVyUXVldWUsXG4gICAgYW5hbHl0aWNzQ29udHJvbGxlcixcbiAgICBjYWNoZUNvbnRyb2xsZXIsXG4gICAgbGl2ZVF1ZXJ5Q29udHJvbGxlcixcbiAgICBkYXRhYmFzZUNvbnRyb2xsZXIsXG4gICAgaG9va3NDb250cm9sbGVyLFxuICAgIGF1dGhEYXRhTWFuYWdlcixcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExvZ2dlckNvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zKTogTG9nZ2VyQ29udHJvbGxlciB7XG4gIGNvbnN0IHtcbiAgICBhcHBJZCxcbiAgICBqc29uTG9ncyxcbiAgICBsb2dzRm9sZGVyLFxuICAgIHZlcmJvc2UsXG4gICAgbG9nTGV2ZWwsXG4gICAgc2lsZW50LFxuICAgIGxvZ2dlckFkYXB0ZXIsXG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBsb2dnZXJPcHRpb25zID0geyBqc29uTG9ncywgbG9nc0ZvbGRlciwgdmVyYm9zZSwgbG9nTGV2ZWwsIHNpbGVudCB9O1xuICBjb25zdCBsb2dnZXJDb250cm9sbGVyQWRhcHRlciA9IGxvYWRBZGFwdGVyKGxvZ2dlckFkYXB0ZXIsIFdpbnN0b25Mb2dnZXJBZGFwdGVyLCBsb2dnZXJPcHRpb25zKTtcbiAgcmV0dXJuIG5ldyBMb2dnZXJDb250cm9sbGVyKGxvZ2dlckNvbnRyb2xsZXJBZGFwdGVyLCBhcHBJZCwgbG9nZ2VyT3B0aW9ucyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWxlc0NvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zKTogRmlsZXNDb250cm9sbGVyIHtcbiAgY29uc3Qge1xuICAgIGFwcElkLFxuICAgIGRhdGFiYXNlVVJJLFxuICAgIGZpbGVzQWRhcHRlcixcbiAgICBkYXRhYmFzZUFkYXB0ZXIsXG4gICAgcHJlc2VydmVGaWxlTmFtZSxcbiAgfSA9IG9wdGlvbnM7XG4gIGlmICghZmlsZXNBZGFwdGVyICYmIGRhdGFiYXNlQWRhcHRlcikge1xuICAgIHRocm93ICdXaGVuIHVzaW5nIGFuIGV4cGxpY2l0IGRhdGFiYXNlIGFkYXB0ZXIsIHlvdSBtdXN0IGFsc28gdXNlIGFuIGV4cGxpY2l0IGZpbGVzQWRhcHRlci4nO1xuICB9XG4gIGNvbnN0IGZpbGVzQ29udHJvbGxlckFkYXB0ZXIgPSBsb2FkQWRhcHRlcihmaWxlc0FkYXB0ZXIsICgpID0+IHtcbiAgICByZXR1cm4gbmV3IEdyaWRTdG9yZUFkYXB0ZXIoZGF0YWJhc2VVUkkpO1xuICB9KTtcbiAgcmV0dXJuIG5ldyBGaWxlc0NvbnRyb2xsZXIoZmlsZXNDb250cm9sbGVyQWRhcHRlciwgYXBwSWQsIHsgcHJlc2VydmVGaWxlTmFtZSB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFVzZXJDb250cm9sbGVyKG9wdGlvbnM6IFBhcnNlU2VydmVyT3B0aW9ucyk6IFVzZXJDb250cm9sbGVyIHtcbiAgY29uc3Qge1xuICAgIGFwcElkLFxuICAgIGVtYWlsQWRhcHRlcixcbiAgICB2ZXJpZnlVc2VyRW1haWxzLFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgZW1haWxDb250cm9sbGVyQWRhcHRlciA9IGxvYWRBZGFwdGVyKGVtYWlsQWRhcHRlcik7XG4gIHJldHVybiBuZXcgVXNlckNvbnRyb2xsZXIoZW1haWxDb250cm9sbGVyQWRhcHRlciwgYXBwSWQsIHsgdmVyaWZ5VXNlckVtYWlscyB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENhY2hlQ29udHJvbGxlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMpOiBDYWNoZUNvbnRyb2xsZXIge1xuICBjb25zdCB7XG4gICAgYXBwSWQsXG4gICAgY2FjaGVBZGFwdGVyLFxuICAgIGNhY2hlVFRMLFxuICAgIGNhY2hlTWF4U2l6ZSxcbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGNhY2hlQ29udHJvbGxlckFkYXB0ZXIgPSBsb2FkQWRhcHRlcihjYWNoZUFkYXB0ZXIsIEluTWVtb3J5Q2FjaGVBZGFwdGVyLCB7YXBwSWQ6IGFwcElkLCB0dGw6IGNhY2hlVFRMLCBtYXhTaXplOiBjYWNoZU1heFNpemUgfSk7XG4gIHJldHVybiBuZXcgQ2FjaGVDb250cm9sbGVyKGNhY2hlQ29udHJvbGxlckFkYXB0ZXIsIGFwcElkKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFuYWx5dGljc0NvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zKTogQW5hbHl0aWNzQ29udHJvbGxlciB7XG4gIGNvbnN0IHtcbiAgICBhbmFseXRpY3NBZGFwdGVyLFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgYW5hbHl0aWNzQ29udHJvbGxlckFkYXB0ZXIgPSBsb2FkQWRhcHRlcihhbmFseXRpY3NBZGFwdGVyLCBBbmFseXRpY3NBZGFwdGVyKTtcbiAgcmV0dXJuIG5ldyBBbmFseXRpY3NDb250cm9sbGVyKGFuYWx5dGljc0NvbnRyb2xsZXJBZGFwdGVyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExpdmVRdWVyeUNvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zKTogTGl2ZVF1ZXJ5Q29udHJvbGxlciB7XG4gIHJldHVybiBuZXcgTGl2ZVF1ZXJ5Q29udHJvbGxlcihvcHRpb25zLmxpdmVRdWVyeSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREYXRhYmFzZUNvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zLCBjYWNoZUNvbnRyb2xsZXI6IENhY2hlQ29udHJvbGxlcik6IERhdGFiYXNlQ29udHJvbGxlciB7XG4gIGNvbnN0IHtcbiAgICBkYXRhYmFzZVVSSSxcbiAgICBkYXRhYmFzZU9wdGlvbnMsXG4gICAgY29sbGVjdGlvblByZWZpeCxcbiAgICBzY2hlbWFDYWNoZVRUTCxcbiAgICBlbmFibGVTaW5nbGVTY2hlbWFDYWNoZSxcbiAgfSA9IG9wdGlvbnM7XG4gIGxldCB7XG4gICAgZGF0YWJhc2VBZGFwdGVyXG4gIH0gPSBvcHRpb25zO1xuICBpZiAoKGRhdGFiYXNlT3B0aW9ucyB8fCAoZGF0YWJhc2VVUkkgJiYgZGF0YWJhc2VVUkkgIT09IGRlZmF1bHRzLmRhdGFiYXNlVVJJKSB8fCBjb2xsZWN0aW9uUHJlZml4ICE9PSBkZWZhdWx0cy5jb2xsZWN0aW9uUHJlZml4KSAmJiBkYXRhYmFzZUFkYXB0ZXIpIHtcbiAgICB0aHJvdyAnWW91IGNhbm5vdCBzcGVjaWZ5IGJvdGggYSBkYXRhYmFzZUFkYXB0ZXIgYW5kIGEgZGF0YWJhc2VVUkkvZGF0YWJhc2VPcHRpb25zL2NvbGxlY3Rpb25QcmVmaXguJztcbiAgfSBlbHNlIGlmICghZGF0YWJhc2VBZGFwdGVyKSB7XG4gICAgZGF0YWJhc2VBZGFwdGVyID0gZ2V0RGF0YWJhc2VBZGFwdGVyKGRhdGFiYXNlVVJJLCBjb2xsZWN0aW9uUHJlZml4LCBkYXRhYmFzZU9wdGlvbnMpXG4gIH0gZWxzZSB7XG4gICAgZGF0YWJhc2VBZGFwdGVyID0gbG9hZEFkYXB0ZXIoZGF0YWJhc2VBZGFwdGVyKVxuICB9XG4gIHJldHVybiBuZXcgRGF0YWJhc2VDb250cm9sbGVyKGRhdGFiYXNlQWRhcHRlciwgbmV3IFNjaGVtYUNhY2hlKGNhY2hlQ29udHJvbGxlciwgc2NoZW1hQ2FjaGVUVEwsIGVuYWJsZVNpbmdsZVNjaGVtYUNhY2hlKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRIb29rc0NvbnRyb2xsZXIob3B0aW9uczogUGFyc2VTZXJ2ZXJPcHRpb25zLCBkYXRhYmFzZUNvbnRyb2xsZXI6IERhdGFiYXNlQ29udHJvbGxlcik6IEhvb2tzQ29udHJvbGxlciB7XG4gIGNvbnN0IHtcbiAgICBhcHBJZCxcbiAgICB3ZWJob29rS2V5LFxuICB9ID0gb3B0aW9ucztcbiAgcmV0dXJuIG5ldyBIb29rc0NvbnRyb2xsZXIoYXBwSWQsIGRhdGFiYXNlQ29udHJvbGxlciwgd2ViaG9va0tleSk7XG59XG5cbmludGVyZmFjZSBQdXNoQ29udHJvbGxpbmcge1xuICBwdXNoQ29udHJvbGxlcjogUHVzaENvbnRyb2xsZXIsXG4gIGhhc1B1c2hTY2hlZHVsZWRTdXBwb3J0OiBib29sZWFuLFxuICBwdXNoQ29udHJvbGxlclF1ZXVlOiBQdXNoUXVldWUsXG4gIHB1c2hXb3JrZXI6IFB1c2hXb3JrZXJcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFB1c2hDb250cm9sbGVyKG9wdGlvbnM6IFBhcnNlU2VydmVyT3B0aW9ucyk6IFB1c2hDb250cm9sbGluZyB7XG4gIGNvbnN0IHtcbiAgICBzY2hlZHVsZWRQdXNoLFxuICAgIHB1c2gsXG4gIH0gPSBvcHRpb25zO1xuXG4gIGNvbnN0IHB1c2hPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgcHVzaCk7XG4gIGNvbnN0IHB1c2hRdWV1ZU9wdGlvbnMgPSBwdXNoT3B0aW9ucy5xdWV1ZU9wdGlvbnMgfHwge307XG4gIGlmIChwdXNoT3B0aW9ucy5xdWV1ZU9wdGlvbnMpIHtcbiAgICBkZWxldGUgcHVzaE9wdGlvbnMucXVldWVPcHRpb25zO1xuICB9XG5cbiAgLy8gUGFzcyB0aGUgcHVzaCBvcHRpb25zIHRvbyBhcyBpdCB3b3JrcyB3aXRoIHRoZSBkZWZhdWx0XG4gIGNvbnN0IHB1c2hBZGFwdGVyID0gbG9hZEFkYXB0ZXIocHVzaE9wdGlvbnMgJiYgcHVzaE9wdGlvbnMuYWRhcHRlciwgUGFyc2VQdXNoQWRhcHRlciwgcHVzaE9wdGlvbnMpO1xuICAvLyBXZSBwYXNzIHRoZSBvcHRpb25zIGFuZCB0aGUgYmFzZSBjbGFzcyBmb3IgdGhlIGFkYXRwZXIsXG4gIC8vIE5vdGUgdGhhdCBwYXNzaW5nIGFuIGluc3RhbmNlIHdvdWxkIHdvcmsgdG9vXG4gIGNvbnN0IHB1c2hDb250cm9sbGVyID0gbmV3IFB1c2hDb250cm9sbGVyKCk7XG4gIGNvbnN0IGhhc1B1c2hTdXBwb3J0ID0gISEocHVzaEFkYXB0ZXIgJiYgcHVzaCk7XG4gIGNvbnN0IGhhc1B1c2hTY2hlZHVsZWRTdXBwb3J0ID0gaGFzUHVzaFN1cHBvcnQgJiYgKHNjaGVkdWxlZFB1c2ggPT09IHRydWUpO1xuXG4gIGNvbnN0IHtcbiAgICBkaXNhYmxlUHVzaFdvcmtlclxuICB9ID0gcHVzaFF1ZXVlT3B0aW9ucztcblxuICBjb25zdCBwdXNoQ29udHJvbGxlclF1ZXVlID0gbmV3IFB1c2hRdWV1ZShwdXNoUXVldWVPcHRpb25zKTtcbiAgbGV0IHB1c2hXb3JrZXI7XG4gIGlmICghZGlzYWJsZVB1c2hXb3JrZXIpIHtcbiAgICBwdXNoV29ya2VyID0gbmV3IFB1c2hXb3JrZXIocHVzaEFkYXB0ZXIsIHB1c2hRdWV1ZU9wdGlvbnMpO1xuICB9XG4gIHJldHVybiB7XG4gICAgcHVzaENvbnRyb2xsZXIsXG4gICAgaGFzUHVzaFN1cHBvcnQsXG4gICAgaGFzUHVzaFNjaGVkdWxlZFN1cHBvcnQsXG4gICAgcHVzaENvbnRyb2xsZXJRdWV1ZSxcbiAgICBwdXNoV29ya2VyXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEF1dGhEYXRhTWFuYWdlcihvcHRpb25zOiBQYXJzZVNlcnZlck9wdGlvbnMpIHtcbiAgY29uc3Qge1xuICAgIGF1dGgsXG4gICAgZW5hYmxlQW5vbnltb3VzVXNlcnNcbiAgfSA9IG9wdGlvbnM7XG4gIHJldHVybiBhdXRoRGF0YU1hbmFnZXIoYXV0aCwgZW5hYmxlQW5vbnltb3VzVXNlcnMpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREYXRhYmFzZUFkYXB0ZXIoZGF0YWJhc2VVUkksIGNvbGxlY3Rpb25QcmVmaXgsIGRhdGFiYXNlT3B0aW9ucykge1xuICBsZXQgcHJvdG9jb2w7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkVVJJID0gdXJsLnBhcnNlKGRhdGFiYXNlVVJJKTtcbiAgICBwcm90b2NvbCA9IHBhcnNlZFVSSS5wcm90b2NvbCA/IHBhcnNlZFVSSS5wcm90b2NvbC50b0xvd2VyQ2FzZSgpIDogbnVsbDtcbiAgfSBjYXRjaChlKSB7IC8qICovIH1cbiAgc3dpdGNoIChwcm90b2NvbCkge1xuICBjYXNlICdwb3N0Z3JlczonOlxuICAgIHJldHVybiBuZXcgUG9zdGdyZXNTdG9yYWdlQWRhcHRlcih7XG4gICAgICB1cmk6IGRhdGFiYXNlVVJJLFxuICAgICAgY29sbGVjdGlvblByZWZpeCxcbiAgICAgIGRhdGFiYXNlT3B0aW9uc1xuICAgIH0pO1xuICBkZWZhdWx0OlxuICAgIHJldHVybiBuZXcgTW9uZ29TdG9yYWdlQWRhcHRlcih7XG4gICAgICB1cmk6IGRhdGFiYXNlVVJJLFxuICAgICAgY29sbGVjdGlvblByZWZpeCxcbiAgICAgIG1vbmdvT3B0aW9uczogZGF0YWJhc2VPcHRpb25zLFxuICAgIH0pO1xuICB9XG59XG4iXX0=